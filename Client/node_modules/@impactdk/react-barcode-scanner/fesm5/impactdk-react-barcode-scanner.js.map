{"version":3,"file":"impactdk-react-barcode-scanner.js","sources":["ng://@impactdk/react-barcode-scanner/react-barcode-scanner/react-barcode-scanner.component.tsx"],"sourcesContent":["import React, { useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { IBarcode, Scanner, IDecoder } from \"@impactdk/barcode-scanner\";\n\ntype Omit<T, K extends keyof T> = Pick<T, Exclude<keyof T, K>>;\n\nexport interface IReactBarcodeScannerRef {\n  start(): void;\n  stop(): void;\n}\n\nexport interface IReactBarcodeScannerProps {\n  /**\n   * @description\n   * Props passed to underlying video element. ID is reserved for DOM access.\n   */\n  videoProps?: Omit<React.VideoHTMLAttributes<HTMLVideoElement>, \"id\" | \"src\">;\n  /**\n   * @description\n   * Callback for when barcode is identified.\n   */\n  onFindBarcode: (barcode: string) => void;\n  /**\n   * @description\n   * Supply decoder responsible for decoding the canvas context made by the scanner.\n   *\n   * @example\n   * import { WasmDecoder } from \"@impactdk/barcode-scanner\";\n   *\n   * const decoder = WasmDecoder.getInstance(\"/public-path/assets\"); // Path to assets installed through included cli.\n   */\n  decoder: IDecoder;\n  /**\n   * @description\n   * If false, the consumer is responsible for starting the scanner through ref public API.\n   *\n   * @default true\n   */\n  initOnMount?: boolean;\n}\n\nconst videoId = \"scanner-video\";\n\n/**\n * @example\n * import { WasmDecoder } from \"@impactdk/barcode-scanner\";\n * import { ReactBarcodeScanner, IReactBarcodeScannerRef } from \"@impactdk/react-barcode-scanner\";\n *\n * const scannerRef = useRef<IReactBarcodeScannerRef>(); // Access to public API, i.e. scannerRef?.start() or scannerRef?.stop().\n *\n * const decoder = WasmDecoder.getInstance(\"/public-path/asssets/barcode-scanner\"); // Path to installed assets.\n *\n * return <ReactBarcodeScanner decoder={decoder} onFindBarcode={setBarcode} ref={scannerRef} />;\n */\nexport const ReactBarcodeScanner = forwardRef<IReactBarcodeScannerRef, IReactBarcodeScannerProps>((props, ref) => {\n  const { videoProps, onFindBarcode, decoder, initOnMount = true } = props;\n\n  const scannerRef = useRef<Scanner | null>(null);\n\n  useEffect(() => {\n    if (initOnMount) {\n      startScanner();\n    }\n\n    return handleUnmount;\n  }, []);\n\n  useImperativeHandle(ref, () => ({\n    start: startScanner,\n    stop: stopScanner\n  }));\n\n  function startScanner(): void {\n    if (scannerRef.current) {\n      return;\n    }\n\n    const video = document.getElementById(videoId) as HTMLVideoElement;\n\n    scannerRef.current = new Scanner(video, decoder, (() => {\n      let previousValue: string;\n\n      return ({ rawValue }: IBarcode) => {\n        // Compare with previous value, to ensure the correct one has been found.\n        if (!previousValue || rawValue !== previousValue) {\n          previousValue = rawValue;\n          return;\n        }\n\n        onFindBarcode(rawValue);\n      };\n    })());\n\n    scannerRef.current.start();\n  }\n\n  function stopScanner(): void {\n    if (scannerRef.current != null) {\n      scannerRef.current.stop();\n      scannerRef.current = null;\n    }\n  }\n\n  function handleUnmount(): void {\n    stopScanner();\n  }\n\n  return (\n    <video {...videoProps} id={videoId} />\n  );\n});\n"],"names":[],"mappings":";;;;AAwCA,IAAM,OAAO,GAAG,eAAe,CAAC;;;;;;;;;;;;AAahC,IAAa,mBAAmB,GAAG,UAAU,CAAqD,UAAC,KAAK,EAAE,GAAG;IACnG,IAAA,6BAAU,EAAE,mCAAa,EAAE,uBAAO,EAAE,sBAAkB,EAAlB,uCAAkB,CAAW;IAEzE,IAAM,UAAU,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IAEhD,SAAS,CAAC;QACR,IAAI,WAAW,EAAE;YACf,YAAY,EAAE,CAAC;SAChB;QAED,OAAO,aAAa,CAAC;KACtB,EAAE,EAAE,CAAC,CAAC;IAEP,mBAAmB,CAAC,GAAG,EAAE,cAAM,QAAC;QAC9B,KAAK,EAAE,YAAY;QACnB,IAAI,EAAE,WAAW;KAClB,IAAC,CAAC,CAAC;IAEJ,SAAS,YAAY;QACnB,IAAI,UAAU,CAAC,OAAO,EAAE;YACtB,OAAO;SACR;QAED,IAAM,KAAK,GAAG,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAqB,CAAC;QAEnE,UAAU,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,CAAC;YAChD,IAAI,aAAqB,CAAC;YAE1B,OAAO,UAAC,EAAsB;oBAApB,sBAAQ;;gBAEhB,IAAI,CAAC,aAAa,IAAI,QAAQ,KAAK,aAAa,EAAE;oBAChD,aAAa,GAAG,QAAQ,CAAC;oBACzB,OAAO;iBACR;gBAED,aAAa,CAAC,QAAQ,CAAC,CAAC;aACzB,CAAC;SACH,GAAG,CAAC,CAAC;QAEN,UAAU,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;KAC5B;IAED,SAAS,WAAW;QAClB,IAAI,UAAU,CAAC,OAAO,IAAI,IAAI,EAAE;YAC9B,UAAU,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;YAC1B,UAAU,CAAC,OAAO,GAAG,IAAI,CAAC;SAC3B;KACF;IAED,SAAS,aAAa;QACpB,WAAW,EAAE,CAAC;KACf;IAED,QACE,0CAAW,UAAU,IAAE,EAAE,EAAE,OAAO,IAAI,EACtC;CACH,CAAC;;;;"}