!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rawr"),require("rawr/transports/worker")):"function"==typeof define&&define.amd?define("@impactdk/barcode-scanner",["exports","rawr","rawr/transports/worker"],t):t(((e=e||self).impactdk=e.impactdk||{},e.impactdk["barcode-scanner"]={}),e.rawr,e.transport)}(this,function(e,t,n){"use strict";function r(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function i(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}t=t&&t.hasOwnProperty("default")?t["default"]:t,n=n&&n.hasOwnProperty("default")?n["default"]:n;var o=function(){function e(e,t,n){this.videoElement=e,this.decoder=t,this.cb=n,this.constraints={video:{facingMode:"environment"},audio:!1},this.running=!1,this.resolve=function(){return null},this.reject=function(){return null},this.decodeCanvas=document.createElement("canvas"),this.onLoadedData=this.onLoadedData.bind(this),this.getOnFrameHandler=this.getOnFrameHandler.bind(this)}return e.prototype.start=function(){return r(this,void 0,void 0,function(){var e,t=this;return i(this,function(n){switch(n.label){case 0:return this.running=!0,this.videoElement=this.videoElement,this.videoElement.addEventListener("loadeddata",this.onLoadedData),this.videoElement.setAttribute("autoplay",""),this.videoElement.setAttribute("muted",""),this.videoElement.setAttribute("playsinline",""),[4,navigator.mediaDevices.getUserMedia(this.constraints)];case 1:return e=n.sent(),this.videoElement.srcObject=e,[2,new Promise(function(e,n){t.resolve=e,t.reject=n})]}})})},e.prototype.stop=function(){this.videoElement&&this.videoElement.srcObject&&(this.videoElement.removeEventListener("loadeddata",this.onLoadedData),this.videoElement.srcObject.getTracks().forEach(function(e){return e.stop()}),this.videoElement.srcObject=null,this.running=!1)},e.prototype.onLoadedData=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return this.decodeCanvas&&this.videoElement?(this.decodeCanvas.height=this.videoElement.videoHeight,this.decodeCanvas.width=this.videoElement.videoWidth,requestAnimationFrame(this.getOnFrameHandler()),[2]):(this.reject(),[2])})})},e.prototype.getOnFrameHandler=function(){var e=this;if(!this.decodeCanvas)return function(){return null};this.resolve();var t=this.decodeCanvas.getContext("2d"),n=function(){return r(e,void 0,void 0,function(){var e,r;return i(this,function(i){switch(i.label){case 0:if(!this.decodeCanvas||!this.videoElement)return[2];t.drawImage(this.videoElement,0,0,this.videoElement.videoWidth,this.videoElement.videoHeight),e=null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.decoder.decode(t)];case 2:return(e=i.sent())&&this.cb(e),[3,4];case 3:return r=i.sent(),console.log({decodeError:r.message}),[3,4];case 4:return this.running&&requestAnimationFrame(n),[2]}})})};return n},e}(),s="wasm-worker.js";var a=function(){function e(e){void 0===e&&(e="");var r=e+"/"+s;this.worker=new Worker(r),this.wasmDecoder=t({transport:n(this.worker)})}return e.getInstance=function(t){if(void 0===t&&(t=""),!e.instance){var n=t.replace(/\/$/,"");e.instance=new e(n)}return e.instance},e.removeInstance=function(){e.instance.dispose(),e.instance=null},e.prototype.decode=function(e){var t=e.canvas,n=t.width,r=t.height,i=e.getImageData(0,0,n,r);return this.wasmDecoder.methods.detectUrl(n,r,i)},e.prototype.dispose=function(){this.wasmDecoder=null,this.worker.terminate()},e}();e.Scanner=o,e.WasmDecoder=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=impactdk-barcode-scanner.umd.min.js.map